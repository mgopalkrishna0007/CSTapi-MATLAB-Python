function defineFloquetModes(mws, nModes)
    % Check if FloquetPort exists
    try
        % Attempt to reset Floquet Port
        invoke(mws, 'AddToHistory', 'Reset FloquetPort', 'With FloquetPort\n.Reset\nEnd With');
        
        % Configure Zmin Port
        zminCommands = sprintf(['With FloquetPort\n',...
            '.Port "Zmin"\n',...
            '.SetNumberOfModesConsidered "%d"\n',...
            '.SetDistanceToReferencePlane "0.0"\n',...
            '.SetUseCircularPolarization "False"\n',...
            'End With'], nModes);
        invoke(mws, 'AddToHistory', 'Configure Zmin Port', zminCommands);
        
        % Configure Zmax Port
        zmaxCommands = sprintf(['With FloquetPort\n',...
            '.Port "Zmax"\n',...
            '.SetNumberOfModesConsidered "%d"\n',...
            '.SetDistanceToReferencePlane "0.0"\n',...
            '.SetUseCircularPolarization "False"\n',...
            'End With'], nModes);
        invoke(mws, 'AddToHistory', 'Configure Zmax Port', zmaxCommands);
        
    catch ME
        % Handle errors related to object references
        fprintf('Error occurred while defining Floquet modes: %s\n', ME.message);
        disp('Ensure that the Floquet ports are properly defined in CST.');
    end
end



